name: Tache 3 #!Baseplate with some simple args, will change later, main parts taken from https://github.com/actions/setup-java, online doc, marketplace actions,
#And a few others like the initial build given (the one for tache 2)

on:
  push:
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - name: 'Utiliser Garbage Collector G1' #Garbage collector
            jvm_flag: '-XX:+UseG1GC'
          - name: 'DÃ©finir CICompilerCount Ã  2'
            jvm_flag: '-XX:CICompilerCount=2'
          - name: 'Activer GC Details Printing'
            jvm_flag: '-XX:+PrintGCDetails'
          - name: 'DÃ©sactiver les gestionnaires de signaux utilisateur'
            jvm_flag: '-XX:-AllowUserSignalHandlers'
          - name: 'DÃ©finir le chemin du HeapDump'
            jvm_flag: '-XX:HeapDumpPath=./heapdumps'
          - name: 'Options de mÃ©moire et dÃ©duplication de chaÃ®nes'
            jvm_flag: '-Xms1g -Xmx2g -XX:+UseCompressedOops -XX:+UseStringDeduplication'

    name: Build and Test with flag ${{ matrix.jvm_flag }}

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-java@v4.2.1
        with:
          distribution: 'temurin'
          java-version: '17'
          cache: 'maven'

      - name: Build and Test with Maven and flag ${{ matrix.jvm_flag }}
        env:
          MAVEN_OPTS: ${{ matrix.jvm_flag }}
        timeout-minutes: 15
        run: ./mvnw -B verify

      - name: Get JaCoCo Coverage
        id: coverage  
        run: |
          coverage=$(python3 config/coverage.py target/site/jacoco/jacoco.csv) 
          echo "COVERAGE=$coverage" >> $GITHUB_ENV

      - name: Fail if coverage has not improved.
        run: |
          coverage=$COVERAGE
          threshold=24.46
          if (( $(echo "$coverage - $threshold <= 0.1" | bc -l) )); then
            echo "Coverage is not improved."
            exit 1
          else
            echo "New coverage: $coverage%. Coverage is improved!"
          fi
      - name: Celebrate Success
        if: success()
        run: |
          echo "Les tests passent LET'S GOOOOOOOOOOðŸŽ‰"
          echo "â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¯â Ÿâ ›â ‹â ‰â ‰â ‰â ‰â ‰â ™â ›â “â ¿â ¿â£Ÿâ£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¯â žâ ‹â¢â¡€â ¤â €â ’â €â €â €â â ’â  â¢€â ¢â €â €â €â ‰â ›â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â£¿â£¿â£¿â¡¿â£¿â ½â ›â ƒâ£€â ”â ‰â €â €â €â €â¢€â£€â£€â£¤â£¤â ¤â ¤â „â ˆâ €â ‘â¢€â¡€â €â €â ˆâ ™â ¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â ¿â ›â ¿â ›â ƒâ €â €â¡â â €â¢€â£ â£´â£¾â¡¿â ›â ‰â â €â €â €â €â£€â¢´â ¤â¢„â¡€â €â €â €â €â €â €â ˆâ »â Ÿâ¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â¡¿â¡¿â¢¦â €â €â €â €â „â €â €â €â €â¢€â£´â£¿â£«â ¤â ”â šâ ›â ’â ’â šâ ›â ¯â ™â ¢â¡•â ˆâ ¢â €â €â €â €â €â €â €â €â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£·â¡‡â ˜â¡„â €â €â ˆâ €â €â €â  â¢´â¡¾â ›â â €â €â €â €â ‚â €â €â €â €â €â €â €â ¸â €â €â €â €â €â €â €â €â €â €â €â »â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â¡‡â „â šâ ¦â¢€â£€â£§â ¤â ”â ’â ›â£‰â£‰â£‰â£‰â£‰â£‰â£‰â¡â¢»â£¦â¡€â €â €â „â£´â ‡â €â €â €â €â €â €â €â €â €â €â €â €â ¹â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â¡¿â â¢€â ¤â ’â£‰â¡¥â ´â –â¢›â¡¯â£â ‰â¢‰â ¤â¢¤â¡€â¢€â ¬â£â¢‰â ¿â¢¿â£¦â¡€â ˆâ¢»â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ¹â£¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â¡‡â  â£¡â¢´â¡Ÿâ “â ¦â¡€â£°â ƒâ €â ˆâ ³â â €â €â »â ƒâ €â ˜â ‹â €â €â ·â “â¡€â €â ‚â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£·â£¾â £â¡¾â €â €â €â ˆâ â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ˜â¢„â €â¢€â €â €â €â €â €â €â †â ˜â¡„â €â €â €â €â¢¸â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â €â  â €â €â €â €â €â €â €â €â €â €â €â¢€â €â €â €â €â €â¡€â €â¢€â €â£€â£¼â£†â ˆâ¢§â¡€â €â €â €â €â ¸â €â¢¹â¡€â €â €â €â ¸â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â£‡â €â €â €â¢€â£€â¢ â ¤â â ¶â ‚â â ’â ˆâ¢¹â£¶â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£†â ˆâ¢—â €â €â €â €â €â£‡â €â¢‡â €â €â €â €â¡·â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â£¿â£·â£„â£Œâ €â €â €â €â €â£€â£€â£¤â£„â£¤â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£†â ˆâ¢†â €â €â €â €â¢¸â €â ˜â €â €â €â €â£â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â£¿â£¿â£·â¡¿â¡¿â ¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£†â ˆâ¢¾â¡„â €â €â ˜â¡‡â €â €â €â €â¢°â£·â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡€â ¹â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¦â ˆâ ‡â €â €â €â£§â €â €â €â €â£¸â£»â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â €â¢»â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â ¿â¢¿â£¿â£¿â£§â €â „â €â €â¢ â €â €â¢°â£ â£¯â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£‡â €â¢»â£¿â£¿â£¿â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â Ÿâ ›â ƒâ €â €â €â ‰â¢»â£¿â €â €â €â €â¢¸â €â €â£¼â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¿â£ â ´â Ÿâ¢‹â¡â ¾â ¿â ‹â ™â »â ‹â ‰â ‰â ‰â €â €â €â €â €â¢ â£€â£€â£ â â €â¡¸â €â €â¢¸â €â£°â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¢±â ƒâ €â €â €â €â €â €â €â €â €â €â €â ˆâ¡–â ¤â£¤â£€â£¼â¡·â žâ¢â£ â£¾â ƒâ €â €â£¼â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£—â¡‡â €â£€â €â €â €â €â €â¢€â¡€â €â €â£¤â£€â €â£°â£¡â£´â –â »â£•â €â¢ºâ »â Šâ â €â£ â£¾â£¯â£¾â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â£¿â£¿â£¿â£¿â£¿â ˜â¢§â¡´â ›â£†â£ â –â¢„â£€â£žâ£‰â£²â¡¾â µâ šâ ‹â ‰â â ˆâ €â ‰â ›â “â €â €â ’â ’â ¿â ¹â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â£„â¡‰â ›â ›â ›â¢›â£›â£‰â£©â£¥â¡„â ’â ‚â €â €â €â â ‰â €â¢€â£ â£Œâ£·â£–â£¤â£„â£€â ˜â »â£»â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¯â£­â£­â£­â£¿â£¿â£»â£¿â£·â£·â£·â£¶â£¶â£¶â£¶â£ºâ£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£µâ£†â£¬â£˜â£»â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿"
          echo "â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â£­â£›â£¿"


      # Failure message with a joke
      - name: Console in Failure
        if: failure()
        run: |
          echo "Oh f***, something's gone wucky here"
          echo "â£€â£ â£¤â£¤â£¤â£¤â¢¤â£¤â£„â£€â£€â£€â£€â¡€â¡€â „â „â „â „â „â „â „â „â „â „â „â „â „"
          echo "â „â ‰â ¹â£¾â£¿â£›â£¿â£¿â£žâ£¿â£›â£ºâ£»â¢¾â£¾â£¿â£¿â£¿â£¶â£¶â£¶â£„â¡€â „â „â „"
          echo "â „â „â  â£¿â£·â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¯â£¿â£¿â£¿â£¿â£¿â£¿â£†â „â „"
          echo "â „â „â ˜â ›â ›â ›â ›â ‹â ¿â£·â£¿â£¿â¡¿â£¿â¢¿â Ÿâ Ÿâ Ÿâ »â »â£¿â£¿â£¿â£¿â¡€â „"
          echo "â „â¢€â „â „â „â „â „â „â „â „â¢›â£¿â£â „â „â ’â ‚â „â „â£€â£°â£¿â£¿â£¿â£¿â¡€"
          echo "â „â ‰â ›â ºâ¢¶â£·â¡¶â ƒâ „â „â ¨â£¿â£¿â¡‡â „â¡ºâ£¾â£¾â£¾â£¿â£¿â£¿â£¿â£½â£¿â£¿"
          echo "â „â „â „â „â „â ›â â „â „â „â¢€â£¿â£¿â£§â¡€â „â ¹â£¿â£¿â£¿â£¿â£¿â¡¿â£¿â£»â£¿"
          echo "â „â „â „â „â „â „â „â „â „â „â „â ‰â ›â Ÿâ ‡â¢€â¢°â£¿â£¿â£¿â£â ‰â¢¿â£½â¢¿â¡"
          echo "â „â „â „â „â „â „â „â „â „â „â „â  â ¤â£¤â£´â£¾â£¿â£¿â£¾â£¿â£¿â£¦â „â¢¹â¡¿â „"
          echo "â „â „â „â „â „â „â „â „â ’â£³â£¶â£¤â£¤â£„â£€â£€â¡ˆâ£€â¢â¢â¢â£ˆâ£„â¢â ƒâ „"
          echo "â „â „â „â „â „â „â „â „â „â£°â£¿â£›â£»â¡¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡¯â „â „"
          echo "â „â „â „â „â „â „â „â „â „â£¬â£½â£¿â£»â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â â „â „"
          echo "â „â „â „â „â „â „â „â „â „â¢˜â£¿â£¿â£»â£›â£¿â¡¿â£Ÿâ£»â£¿â£¿â£¿â£¿â¡Ÿâ „â „â „"
          echo "â „â „â „â „â „â „â „â „â „â „â „â ›â¢›â¢¿â£¿â£¿â£¿â£¿â£¿â£¿â£·â¡¿â â „â „â „"
          echo "â „â „â „â „â „â „â „â „â „â „â „â „â „â „â ‰â ‰â ‰â ‰â ˆâ „â „â „â „â „â „â „"

  
